<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body>
    <header>
        <div id="user-info">
            <!-- 로그인한 사용자의 닉네임을 표시 -->
        </div>
        <div id="user-buttons">
            <button id="logout-button">Logout</button>
        </div>
    </header>
    <main>
        <h1>Your Posts</h1>
        <ul id="user-posts">
            <!-- 사용자 글 목록을 표시 -->
        </ul>
    </main>
    <script>
        // 로그인 상태 확인 및 사용자 정보 표시
        function checkLogin() {
            const token = localStorage.getItem('token');
            const userInfo = document.getElementById('user-info');
            if (token) {
                const user = jwt_decode(token); // jwt-decode 라이브러리 사용
                userInfo.innerHTML = `Hello, ${user.username}`;
            } else {
                window.location.href = '/login.html'; // 로그인 상태가 아니면 로그인 페이지로 리디렉션
            }
        }

        // 사용자 글 목록 로드
        async function loadUserPosts() {
            const response = await fetch('/users/posts');
            const posts = await response.json();
            const postsList = document.getElementById('user-posts');
            postsList.innerHTML = '';

            posts.forEach(post => {
                const postItem = document.createElement('li');
                postItem.innerHTML = `<a href="/users/post=${post._id}">${post.title}</a>`;
                postsList.appendChild(postItem);
            });
        }

        // 로그아웃 처리
        document.getElementById('logout-button').addEventListener('click', async () => {
            const response = await fetch('/users/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            if (response.ok) {
                localStorage.removeItem('token');
                window.location.href = '/login.html';
            } else {
                const result = await response.json();
                alert('Logout failed: ' + result.message);
            }
        });

        // 페이지 로드 시 로그인 상태 확인 및 사용자 글 목록 로드
        checkLogin();
        loadUserPosts();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jwt-decode/2.2.0/jwt-decode.min.js"></script>
</body>
</html>
